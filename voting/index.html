<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM ä½¿ç”¨è°ƒç ” - å¸¸ç”¨/çº¢é»‘æ¦œæŠ•ç¥¨</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 40px rgba(59, 130, 246, 0.8); }
        }
        .glow-animation {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // LLM å·¥å…·åˆ—è¡¨ - å›½å†…ä¼˜å…ˆï¼Œå›½å¤–ä¸»æµä¿ç•™
        const LLM_TOOLS = [
            'è±†åŒ…', 'Kimi', 'DeepSeek', 'é€šä¹‰åƒé—®', 'æ–‡å¿ƒä¸€è¨€',
            'ChatGPT', 'Claude', 'Gemini',
            'Copilot', 'Perplexity', 'æ™ºè°±æ¸…è¨€', 'è®¯é£æ˜Ÿç«',
        ];

        const VOTE_TYPES = {
            frequent: { 
                label: 'å¸¸ç”¨', 
                color: 'bg-blue-500', 
                textColor: 'text-blue-400', 
                icon: 'â­',
                multiple: true,
                description: 'å¯å¤šé€‰'
            },
            good: { 
                label: 'æœ€å¥½ç”¨', 
                color: 'bg-green-500', 
                textColor: 'text-green-400', 
                icon: 'ğŸ‘',
                multiple: false,
                description: 'ä»…1ç¥¨'
            },
            bad: { 
                label: 'æœ€ä¸å¥½ç”¨', 
                color: 'bg-red-500', 
                textColor: 'text-red-400', 
                icon: 'ğŸ‘',
                multiple: false,
                description: 'ä»…1ç¥¨'
            }
        };

        function LLMVotingApp() {
            const [mode, setMode] = useState('display');
            const [votes, setVotes] = useState({});
            const [myVotes, setMyVotes] = useState({ 
                frequent: [], // æ•°ç»„ï¼Œå¯å¤šé€‰
                good: null,   // å­—ç¬¦ä¸²ï¼Œå•é€‰
                bad: null     // å­—ç¬¦ä¸²ï¼Œå•é€‰
            });
            const [loading, setLoading] = useState(true);
            const [showQR, setShowQR] = useState(false);
            const [customUrl, setCustomUrl] = useState('');
            const [qrUrl, setQrUrl] = useState('');
            const qrRef = useRef(null);

            useEffect(() => {
                loadVotes();
                const interval = setInterval(loadVotes, 2000);
                return () => clearInterval(interval);
            }, []);

            useEffect(() => {
                if (showQR && qrRef.current && qrUrl) {
                    qrRef.current.innerHTML = '';
                    new QRCode(qrRef.current, {
                        text: qrUrl,
                        width: 256,
                        height: 256,
                        colorDark: '#000000',
                        colorLight: '#ffffff',
                    });
                }
            }, [showQR, qrUrl]);

            useEffect(() => {
                const protocol = window.location.protocol;
                if (protocol === 'http:' || protocol === 'https:') {
                    const url = window.location.href;
                    setQrUrl(url);
                    setCustomUrl(url);
                } else {
                    setCustomUrl('http://192.168.1.100:8000/llm-voting.html');
                }
            }, []);

            async function loadVotes() {
                try {
                    const result = await window.storage.get('llm-votes-v2', true);
                    if (result && result.value) {
                        setVotes(JSON.parse(result.value));
                    }
                    setLoading(false);
                } catch (error) {
                    console.error('åŠ è½½æŠ•ç¥¨å¤±è´¥:', error);
                    setLoading(false);
                }
            }

            async function saveVotes(newVotes) {
                try {
                    await window.storage.set('llm-votes-v2', JSON.stringify(newVotes), true);
                    setVotes(newVotes);
                } catch (error) {
                    console.error('ä¿å­˜æŠ•ç¥¨å¤±è´¥:', error);
                    alert('æŠ•ç¥¨ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            }

            function handleVote(tool, voteType) {
                const voteConfig = VOTE_TYPES[voteType];
                
                if (voteConfig.multiple) {
                    // å¸¸ç”¨ç¥¨ - å¯å¤šé€‰
                    const currentVotes = [...myVotes.frequent];
                    const index = currentVotes.indexOf(tool);
                    
                    if (index > -1) {
                        // å–æ¶ˆæŠ•ç¥¨
                        currentVotes.splice(index, 1);
                        setMyVotes({ ...myVotes, frequent: currentVotes });
                        
                        // æ›´æ–°æ•°æ®
                        const newVotes = { ...votes };
                        if (newVotes[tool] && newVotes[tool].frequent > 0) {
                            newVotes[tool].frequent--;
                        }
                        saveVotes(newVotes);
                    } else {
                        // æ·»åŠ æŠ•ç¥¨
                        currentVotes.push(tool);
                        setMyVotes({ ...myVotes, frequent: currentVotes });
                        
                        // æ›´æ–°æ•°æ®
                        const newVotes = { ...votes };
                        if (!newVotes[tool]) {
                            newVotes[tool] = { frequent: 0, good: 0, bad: 0 };
                        }
                        newVotes[tool].frequent++;
                        saveVotes(newVotes);
                    }
                } else {
                    // å•é€‰ç¥¨ï¼ˆæœ€å¥½ç”¨/æœ€ä¸å¥½ç”¨ï¼‰
                    if (myVotes[voteType]) {
                        alert(`ä½ å·²ç»æŠ•è¿‡"${voteConfig.label}"ç¥¨äº†ï¼`);
                        return;
                    }

                    const newVotes = { ...votes };
                    if (!newVotes[tool]) {
                        newVotes[tool] = { frequent: 0, good: 0, bad: 0 };
                    }
                    newVotes[tool][voteType]++;
                    setMyVotes({ ...myVotes, [voteType]: tool });
                    saveVotes(newVotes);
                }
            }

            async function resetVotes() {
                if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æŠ•ç¥¨å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                    await saveVotes({});
                    setMyVotes({ frequent: [], good: null, bad: null });
                    alert('æŠ•ç¥¨å·²é‡ç½®ï¼');
                }
            }

            function getToolStats(tool) {
                const toolVotes = votes[tool] || { frequent: 0, good: 0, bad: 0 };
                return {
                    frequent: toolVotes.frequent || 0,
                    good: toolVotes.good || 0,
                    bad: toolVotes.bad || 0,
                    total: (toolVotes.frequent || 0) + (toolVotes.good || 0) + (toolVotes.bad || 0)
                };
            }

            function handleGenerateQR() {
                if (!customUrl.trim()) {
                    alert('è¯·å…ˆè¾“å…¥è®¿é—® URLï¼');
                    return;
                }
                setQrUrl(customUrl);
                setShowQR(true);
            }

            function copyToClipboard() {
                navigator.clipboard.writeText(customUrl).then(() => {
                    alert('URL å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                }).catch(() => {
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                });
            }

            const sortedTools = [...LLM_TOOLS].sort((a, b) => {
                const statsA = getToolStats(a);
                const statsB = getToolStats(b);
                return statsB.total - statsA.total;
            });

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-white text-2xl">åŠ è½½ä¸­...</div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen p-4 md:p-8">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="text-center mb-8 slide-up">
                            <h1 className="text-4xl md:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 mb-4">
                                ğŸ¤– LLM ä½¿ç”¨è°ƒç ”
                            </h1>
                            <p className="text-xl text-gray-300 mb-6">å¸¸ç”¨æ¦œ Â· çº¢é»‘æ¦œ å®æ—¶æŠ•ç¥¨</p>
                            
                            {/* æ¨¡å¼åˆ‡æ¢ */}
                            <div className="flex gap-4 justify-center mb-4 flex-wrap">
                                <button
                                    onClick={() => setMode('display')}
                                    className={`px-6 py-3 rounded-lg font-semibold transition-all ${
                                        mode === 'display' 
                                            ? 'bg-blue-600 text-white glow-animation' 
                                            : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                    }`}
                                >
                                    ğŸ“Š å¤§å±å±•ç¤º
                                </button>
                                <button
                                    onClick={() => setMode('vote')}
                                    className={`px-6 py-3 rounded-lg font-semibold transition-all ${
                                        mode === 'vote' 
                                            ? 'bg-green-600 text-white glow-animation' 
                                            : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                    }`}
                                >
                                    ğŸ—³ï¸ æˆ‘è¦æŠ•ç¥¨
                                </button>
                                <button
                                    onClick={resetVotes}
                                    className="px-6 py-3 rounded-lg font-semibold bg-red-600 text-white hover:bg-red-700 transition-all"
                                >
                                    ğŸ”„ é‡ç½®æŠ•ç¥¨
                                </button>
                            </div>

                            {/* URL è®¾ç½®å’ŒäºŒç»´ç  */}
                            <div className="bg-gray-800/50 backdrop-blur-sm rounded-2xl p-6 mb-6 border border-gray-700">
                                <h3 className="text-xl font-bold text-white mb-4">ğŸ“± ç”ŸæˆæŠ•ç¥¨äºŒç»´ç </h3>
                                
                                <div className="mb-4">
                                    <label className="block text-gray-300 text-sm mb-2 text-left">
                                        ğŸŒ è®¿é—®åœ°å€
                                    </label>
                                    <div className="flex gap-2">
                                        <input
                                            type="text"
                                            value={customUrl}
                                            onChange={(e) => setCustomUrl(e.target.value)}
                                            placeholder="http://ä½ çš„IP:8000/llm-voting.html"
                                            className="flex-1 px-4 py-3 bg-gray-700 text-white rounded-lg border border-gray-600 focus:border-purple-500 focus:outline-none"
                                        />
                                        <button
                                            onClick={copyToClipboard}
                                            className="px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-500 transition-all"
                                        >
                                            ğŸ“‹
                                        </button>
                                    </div>
                                    <div className="text-gray-400 text-xs mt-2 text-left space-y-1">
                                        <p>ğŸ’¡ <strong>å¤šWiFiè§£å†³æ–¹æ¡ˆï¼š</strong></p>
                                        <p className="ml-4">â€¢ æ–¹æ¡ˆ1ï¼šä¸Šä¼ åˆ°å…¬å¸å†…ç½‘æœåŠ¡å™¨ï¼ˆæ¨èï¼‰</p>
                                        <p className="ml-4">â€¢ æ–¹æ¡ˆ2ï¼šä½¿ç”¨æ‰‹æœºçƒ­ç‚¹è®©æ‰€æœ‰äººè¿æ¥</p>
                                        <p className="ml-4">â€¢ æ–¹æ¡ˆ3ï¼šä¸Šä¼ åˆ° GitHub Pages / Netlifyï¼ˆå…¬ç½‘è®¿é—®ï¼‰</p>
                                    </div>
                                </div>

                                <button
                                    onClick={handleGenerateQR}
                                    className="px-6 py-3 rounded-lg font-semibold bg-purple-600 text-white hover:bg-purple-700 transition-all"
                                >
                                    ğŸ¯ ç”ŸæˆäºŒç»´ç 
                                </button>

                                {showQR && qrUrl && (
                                    <div className="mt-6 inline-block bg-white p-6 rounded-2xl shadow-2xl slide-up">
                                        <div ref={qrRef} className="mb-4"></div>
                                        <p className="text-gray-800 font-semibold mb-2">æ‰«ç å‚ä¸æŠ•ç¥¨</p>
                                        <p className="text-gray-600 text-sm break-all">{qrUrl}</p>
                                    </div>
                                )}
                            </div>

                            {/* æŠ•ç¥¨è¯´æ˜ */}
                            <div className="bg-gray-800/50 backdrop-blur-sm rounded-lg p-4 inline-block">
                                <p className="text-gray-300 text-sm">
                                    <span className="text-blue-400 mx-2">â­ å¸¸ç”¨ï¼ˆå¯å¤šé€‰ï¼‰</span>
                                    <span className="text-green-400 mx-2">ğŸ‘ æœ€å¥½ç”¨ï¼ˆ1ç¥¨ï¼‰</span>
                                    <span className="text-red-400 mx-2">ğŸ‘ æœ€ä¸å¥½ç”¨ï¼ˆ1ç¥¨ï¼‰</span>
                                </p>
                            </div>
                        </div>

                        {/* å±•ç¤ºæ¨¡å¼ */}
                        {mode === 'display' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {sortedTools.map((tool, index) => {
                                    const stats = getToolStats(tool);
                                    return (
                                        <div 
                                            key={tool}
                                            className="bg-gray-800/50 backdrop-blur-sm rounded-2xl p-6 border border-gray-700 hover:border-purple-500 transition-all slide-up"
                                            style={{ animationDelay: `${index * 0.05}s` }}
                                        >
                                            <div className="flex items-center justify-between mb-4">
                                                <h3 className="text-2xl font-bold text-white">{tool}</h3>
                                                {stats.total > 0 && (
                                                    <span className="bg-purple-600 text-white px-3 py-1 rounded-full text-sm font-semibold">
                                                        {stats.total} ç¥¨
                                                    </span>
                                                )}
                                            </div>
                                            
                                            <div className="space-y-3">
                                                {Object.entries(VOTE_TYPES).map(([type, config]) => {
                                                    const count = stats[type];
                                                    const percentage = stats.total > 0 ? (count / stats.total * 100) : 0;
                                                    return (
                                                        <div key={type}>
                                                            <div className="flex items-center justify-between mb-1">
                                                                <span className={`text-sm font-semibold ${config.textColor}`}>
                                                                    {config.icon} {config.label}
                                                                </span>
                                                                <span className="text-gray-400 text-sm">{count}</span>
                                                            </div>
                                                            <div className="h-2 bg-gray-700 rounded-full overflow-hidden">
                                                                <div 
                                                                    className={`h-full ${config.color} transition-all duration-500`}
                                                                    style={{ width: `${percentage}%` }}
                                                                ></div>
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        )}

                        {/* æŠ•ç¥¨æ¨¡å¼ */}
                        {mode === 'vote' && (
                            <div>
                                {/* æˆ‘çš„æŠ•ç¥¨çŠ¶æ€ */}
                                <div className="bg-gray-800/50 backdrop-blur-sm rounded-2xl p-6 mb-8 border border-gray-700">
                                    <h3 className="text-xl font-bold text-white mb-4">ğŸ“ æˆ‘çš„æŠ•ç¥¨</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div className="bg-gray-700/50 rounded-lg p-4">
                                            <div className="text-blue-400 font-semibold mb-2">
                                                â­ å¸¸ç”¨ï¼ˆå¯å¤šé€‰ï¼‰
                                            </div>
                                            <div className="text-white text-sm">
                                                {myVotes.frequent.length > 0 
                                                    ? myVotes.frequent.join('ã€') 
                                                    : 'æœªæŠ•ç¥¨'}
                                            </div>
                                        </div>
                                        <div className="bg-gray-700/50 rounded-lg p-4">
                                            <div className="text-green-400 font-semibold mb-2">
                                                ğŸ‘ æœ€å¥½ç”¨
                                            </div>
                                            <div className="text-white text-lg">
                                                {myVotes.good || 'æœªæŠ•ç¥¨'}
                                            </div>
                                        </div>
                                        <div className="bg-gray-700/50 rounded-lg p-4">
                                            <div className="text-red-400 font-semibold mb-2">
                                                ğŸ‘ æœ€ä¸å¥½ç”¨
                                            </div>
                                            <div className="text-white text-lg">
                                                {myVotes.bad || 'æœªæŠ•ç¥¨'}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* æŠ•ç¥¨åŒºåŸŸ */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {LLM_TOOLS.map((tool, index) => (
                                        <div 
                                            key={tool}
                                            className="bg-gray-800/50 backdrop-blur-sm rounded-2xl p-6 border border-gray-700 slide-up"
                                            style={{ animationDelay: `${index * 0.03}s` }}
                                        >
                                            <h3 className="text-xl font-bold text-white mb-4">{tool}</h3>
                                            <div className="flex gap-2 flex-wrap">
                                                {Object.entries(VOTE_TYPES).map(([type, config]) => {
                                                    const isSelected = config.multiple 
                                                        ? myVotes.frequent.includes(tool)
                                                        : myVotes[type] === tool;
                                                    const isDisabled = !config.multiple && myVotes[type] !== null && !isSelected;
                                                    
                                                    return (
                                                        <button
                                                            key={type}
                                                            onClick={() => handleVote(tool, type)}
                                                            disabled={isDisabled}
                                                            className={`flex-1 min-w-[100px] px-4 py-3 rounded-lg font-semibold transition-all ${
                                                                isSelected
                                                                    ? `${config.color} text-white ring-2 ring-white`
                                                                    : isDisabled
                                                                    ? 'bg-gray-700 text-gray-500 cursor-not-allowed'
                                                                    : `${config.color} hover:opacity-80 text-white`
                                                            }`}
                                                        >
                                                            {config.icon} {config.label}
                                                        </button>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<LLMVotingApp />, document.getElementById('root'));
    </script>
</body>
</html>